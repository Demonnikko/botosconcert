<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>KOSTYUK PROJECT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        :root {
            --bg-color: #0d0d12;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #aaaaaa;
            --accent-color: #eb4d4b;
            --accent-hover: #ff7675;
            --gold-color: #ffd700;
            --card-radius: 20px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --font-family: 'Inter', system-ui, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: var(--font-family);
            overflow-x: hidden;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 40px;
            background-image: radial-gradient(circle at 10% 20%, rgba(90, 30, 150, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(200, 50, 50, 0.15) 0%, transparent 40%);
            position: relative;
        }

        /* Magic Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, var(--gold-color) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
            opacity: 0;
        }

        @keyframes float {

            0%,
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(0deg);
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translateY(-10vh) rotate(720deg);
            }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff 0%, var(--gold-color) 50%, #fff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: 0% center;
            }

            100% {
                background-position: 200% center;
            }
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .concert-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Admin Panel Styles */
        #admin-panel {
            display: none;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: var(--card-radius);
            margin-bottom: 20px;
            border: 1px solid var(--accent-color);
        }

        #admin-panel h2 {
            margin-bottom: 15px;
        }

        #admin-panel h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--gold-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #444;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--card-radius);
            overflow: hidden;
            transition: var(--transition);
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.6s ease-out forwards;
        }

        .card.hidden {
            display: none !important;
        }

        .card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .card-image-container {
            width: 100%;
            height: auto;
            overflow: hidden;
            position: relative;
        }

        .card-image {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.6s ease;
        }

        .card:hover .card-image {
            transform: scale(1.05);
        }

        .age-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            padding: 5px 10px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Tickets Left Badge */
        .tickets-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #eb4d4b 0%, #ff7675 100%);
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: pulse-badge 2s infinite;
        }

        @keyframes pulse-badge {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .card-content {
            padding: 20px;
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .card-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        /* Countdown Timer */
        .countdown {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            justify-content: center;
        }

        .countdown-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 10px;
            text-align: center;
            min-width: 55px;
        }

        .countdown-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--gold-color);
        }

        .countdown-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Pulsing Button */
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent-color) 0%, #ff6b6b 100%);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            animation: pulse-btn 2s infinite;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                left: -100%;
            }

            50%,
            100% {
                left: 100%;
            }
        }

        @keyframes pulse-btn {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(235, 77, 75, 0.7);
            }

            50% {
                box-shadow: 0 0 20px 5px rgba(235, 77, 75, 0.4);
            }
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:hover {
            background: linear-gradient(135deg, var(--accent-hover) 0%, #ff8787 100%);
            box-shadow: 0 0 30px rgba(235, 77, 75, 0.6);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loader */
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .btn.loading .text {
            display: none;
        }

        .btn.loading .loader {
            display: block;
        }

        .btn.loading {
            animation: none;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: #1a1a20;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            position: relative;
            animation: slideUpModal 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        @keyframes slideUpModal {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .modal-header {
            position: relative;
            height: 300px;
        }

        .modal-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-body {
            padding: 20px;
            margin-top: -60px;
            position: relative;
            z-index: 2;
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .modal-tags {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .modal-desc {
            font-size: 1rem;
            line-height: 1.6;
            color: #ccc;
            margin-bottom: 30px;
            white-space: pre-line;
        }

        .highlight {
            color: var(--gold-color);
            font-weight: 600;
        }

        .modal-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: linear-gradient(to top, #0d0d12 80%, transparent);
            z-index: 10;
        }

        /* Tier Selector Styles */
        .tier-option {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
            position: relative;
        }

        .tier-option input {
            position: absolute;
            opacity: 0;
        }

        .tier-content {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            padding: 12px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .tier-option input:checked+.tier-content {
            border-color: var(--gold-color);
            background: rgba(255, 215, 0, 0.1);
        }

        .tier-name {
            font-weight: 600;
        }

        .tier-price {
            font-weight: 700;
            color: var(--gold-color);
        }
    </style>
</head>

<body>
    <!-- Magic Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Modals -->
    <div class="modal-overlay" id="modal-hooligan">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('hooligan')">‚úï</button>
            <div class="modal-header">
                <img src="./assets/hooligan.png" class="modal-image">
            </div>
            <div class="modal-body">
                <h2 class="modal-title">–•–£–õ–ògan</h2>
                <div class="modal-tags">
                    <span class="tag">16+</span>
                    <span class="tag">–°—Ç–µ–Ω–¥–∞–ø</span>
                    <span class="tag">–ú–∞–≥–∏—è</span>
                </div>
                <div class="modal-desc">
                    <span class="highlight">–ú–∞–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–Ω–¥–∞–ø –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –≤—ã—Ä–æ—Å –∏–∑ –¥–µ—Ç—Å–∫–∏—Ö —Å–∫–∞–∑–æ–∫.</span>

                    –°—É–º–∞—Å—à–µ–¥—à–∏–π –∫–æ–∫—Ç–µ–π–ª—å –∏–∑ –æ—Å—Ç—Ä–æ—É–º–Ω–æ–≥–æ —Å—Ç–µ–Ω–¥–∞–ø–∞ –∏ –¥–µ—Ä–∑–∫–∏—Ö —Ñ–æ–∫—É—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤—è—Ç –≤–∞—Å —Ä—ã–¥–∞—Ç—å –æ—Ç
                    —Å–º–µ—Ö–∞.

                    –ó–¥–µ—Å—å –±–µ—Ä—É—Ç –ø—Ä–µ–¥–º–µ—Ç—ã –∑—Ä–∏—Ç–µ–ª–µ–π, —Ä–∞–∑–±–∏–≤–∞—é—Ç –≤ –¥—Ä–µ–±–µ–∑–≥–∏ –ø—Ä–∏–≤—ã—á–Ω—É—é –º–∞–≥–∏—é –∏ –¥–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –≤–æ–ª—à–µ–±—Å—Ç–≤–æ
                    –±—ã–≤–∞–µ—Ç –≤–∑—Ä–æ—Å–ª—ã–º, –∏—Ä–æ–Ω–∏—á–Ω—ã–º –∏ –ø–æ-—Ö—É–ª–∏–≥–∞–Ω—Å–∫–∏ —Å–º–µ—à–Ω—ã–º.

                    <span class="highlight">–ü–µ—Ä–≤–æ–µ –∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —à–æ—É —Ç–∞–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –≤ –Ø—Ä–æ—Å–ª–∞–≤–ª–µ.</span>

                    –ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –æ—Ç–æ—Ä–≤–∞—Ç—å—Å—è –ø–æ-–≤–∑—Ä–æ—Å–ª–æ–º—É. –î–º–∏—Ç—Ä–∏–π –ö–æ—Å—Ç—é–∫ ‚Äî –∏–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç –±–æ–ª–µ–µ —á–µ–º —Å 10-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º,
                    –ª–∞—É—Ä–µ–∞—Ç –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –ø—Ä–µ–º–∏–π, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –º–∞–≥–∏–∏ —Å –Ω–æ–≥ –Ω–∞ –≥–æ–ª–æ–≤—É.
                </div>
                <!-- Ticket Tiers Selector -->
                <div class="ticket-tiers" style="margin-top: 15px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</h3>

                    <label class="tier-option">
                        <input type="radio" name="hooligan-tier" value="eco" checked>
                        <div class="tier-content">
                            <div class="tier-name">–≠–∫–æ–Ω–æ–º</div>
                            <div class="tier-price" id="display-price-eco">-- ‚ÇΩ</div>
                        </div>
                    </label>

                    <label class="tier-option">
                        <input type="radio" name="hooligan-tier" value="std">
                        <div class="tier-content">
                            <div class="tier-name">–°—Ç–∞–Ω–¥–∞—Ä—Ç</div>
                            <div class="tier-price" id="display-price-std">-- ‚ÇΩ</div>
                        </div>
                    </label>

                    <label class="tier-option">
                        <input type="radio" name="hooligan-tier" value="vip">
                        <div class="tier-content">
                            <div class="tier-name">VIP</div>
                            <div class="tier-price" id="display-price-vip">-- ‚ÇΩ</div>
                        </div>
                    </label>
                </div>

                <div style="height: 100px;"></div> <!-- Spacer for footer -->
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="buyHooligan(); closeModal('hooligan')">
                    <span class="text">üéü –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Placeholder Modals for Secret and Matvey (can be filled similarly) -->
    <div class="modal-overlay" id="modal-secret">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('secret')">‚úï</button>
            <div class="modal-header">
                <img src="./assets/secret.png" class="modal-image">
            </div>
            <div class="modal-body">
                <h2 class="modal-title">–®–æ—É ¬´–°–µ–∫—Ä–µ—Ç¬ª</h2>
                <div class="modal-tags">
                    <span class="tag">12+</span>
                    <span class="tag">–§–∏–ª–æ—Å–æ—Ñ–∏—è</span>
                    <span class="tag">–ú–∞–≥–∏—è</span>
                </div>
                <div class="modal-desc">
                    <span class="highlight">–§–æ–∫—É—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç –Ω–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –∞ –≤–∑–≥–ª—è–¥ –Ω–∞ –∂–∏–∑–Ω—å.</span>

                    –§–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ —à–æ—É –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ª—é–±–∏—Ç –¥—É–º–∞—Ç—å –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å. –ú–æ—â–Ω—ã–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–ª–ª—é–∑–∏–∏ –Ω–∞ –≥—Ä–∞–Ω–∏
                    –±–µ–∑—É–º–∏—è, —Å–º–µ—Ö –∏ —É–¥–∏–≤–ª–µ–Ω–∏–µ ‚Äî –≤—Å—ë —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ —Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏,
                    –≤–µ—Ä–µ, –ª—é–±–≤–∏ –∏ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–∏.

                    –≠—Ç–æ –ø—Ä–æ —Ç–æ, –∫–∞–∫ —Å—Ç–∞—Ç—å —Ç–µ–º, –∫–µ–º —Ç—ã —Ö–æ—á–µ—à—å. –î–ª—è –∑—Ä–∏—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∏—â—É—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑—Ä–µ–ª–∏—â–µ, –∞
                    –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ —Å–æ —Å–º—ã—Å–ª–æ–º.

                    <br>
                    <i>–í–∞—à –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ —ç—Ç–æ—Ç –º–∏—Ä ‚Äî –î–º–∏—Ç—Ä–∏–π –ö–æ—Å—Ç—é–∫, –∏–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç —Å –±–æ–ª–µ–µ —á–µ–º 10-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º, –ª–∞—É—Ä–µ–∞—Ç
                        –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –ø—Ä–µ–º–∏–π. –ï–≥–æ –∞–≤—Ç–æ—Ä—Å–∫–æ–µ —à–æ—É ‚Äî —ç—Ç–æ —Å–∏–Ω—Ç–µ–∑ –≤—ã—Å–æ—á–∞–π—à–µ–≥–æ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ –∏ –≥–ª—É–±–æ–∫–æ–π –ª–∏—á–Ω–æ–π
                        –∏—Å—Ç–æ—Ä–∏–∏.</i>
                </div>
                <div class="price-info" style="margin-top: 15px; font-weight: 600; color: var(--gold-color);">
                    üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–æ–≤: 800 - 1400 ‚ÇΩ
                </div>
                <div style="height: 100px;"></div>
            </div>
            <div class="modal-footer">
                <a href="#" id="modal-link-secret" target="_blank" class="btn">üéü –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</a>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-matvey">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('matvey')">‚úï</button>
            <div class="modal-header">
                <img src="./assets/matvey.png" class="modal-image">
            </div>
            <div class="modal-body">
                <h2 class="modal-title">–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–µ—Å—Ç-—Å–ø–µ–∫—Ç–∞–∫–ª—å ¬´–°–ø–∞—Å—Ç–∏ –ú–∞—Ç–≤–µ—è¬ª</h2>
                <div class="modal-tags">
                    <span class="tag">6+</span>
                    <span class="tag">–î–ª—è –≤—Å–µ–π —Å–µ–º—å–∏</span>
                    <span class="tag">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤</span>
                </div>
                <div class="modal-desc">
                    <span class="highlight">–í–∞—à —Ä–µ–±–µ–Ω–æ–∫ —Ä–µ—à–∞–µ—Ç, —á–µ–º –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –≤–æ–ª—à–µ–±–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è!</span>

                    –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ, –≥–¥–µ –æ—Ç –≤—ã–±–æ—Ä–∞ –¥–µ—Ç–µ–π –∏ –∏—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∑–∞–≤–∏—Å–∏—Ç —Ñ–∏–Ω–∞–ª ‚Äî —Å—á–∞—Å—Ç–ª–∏–≤—ã–π
                    –∏–ª–∏ –Ω–µ—Ç.

                    –Æ–Ω—ã–µ –∑—Ä–∏—Ç–µ–ª–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–º–æ—Ç—Ä—è—Ç, –∞ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≥–µ—Ä–æ—è–º–∏, —É—á–∞—Å—Ç–≤—É—è –≤ —Ñ–æ–∫—É—Å–∞—Ö –∏ –ø—Ä–∏–Ω–∏–º–∞—è —Ä–µ—à–µ–Ω–∏—è. –≠—Ç–æ
                    –ø–µ—Ä–≤—ã–π –≤ –Ø—Ä–æ—Å–ª–∞–≤–ª–µ –º–∞–≥–∏—á–µ—Å–∫–∏–π —Å–ø–µ–∫—Ç–∞–∫–ª—å-–∫–≤–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ –≥–æ–≤–æ—Ä–∏—Ç –æ –Ω–∞—Å—Ç–æ—è—â–∏—Ö
                    —Å–µ–º–µ–π–Ω—ã—Ö —Ü–µ–Ω–Ω–æ—Å—Ç—è—Ö: –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏, —Å–º–µ–ª–æ—Å—Ç–∏ –∏ –¥–æ–±—Ä–æ—Ç–µ.

                    –°–æ–∑–¥–∞—Ç–µ–ª—å ‚Äî –î–º–∏—Ç—Ä–∏–π –ö–æ—Å—Ç—é–∫, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç –∏ –∞–≤—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–µ—Ç, –∫–∞–∫ —É–≤–ª–µ—á—å –∏ –¥–µ—Ç–µ–π,
                    –∏ –≤–∑—Ä–æ—Å–ª—ã—Ö –Ω–∞—Å—Ç–æ—è—â–∏–º –≤–æ–ª—à–µ–±—Å—Ç–≤–æ–º.
                </div>
                <div class="price-info" style="margin-top: 15px; font-weight: 600; color: var(--gold-color);">
                    üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–æ–≤: 500 - 900 ‚ÇΩ
                </div>
                <div style="height: 100px;"></div>
            </div>
            <div class="modal-footer">
                <a href="#" id="modal-link-matvey" target="_blank" class="btn">üéü –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</a>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-mytickets">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('mytickets')">‚úï</button>
            <div class="modal-body" style="margin-top: 60px; padding-top: 20px;">
                <h2 class="modal-title">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</h2>

                <div id="tickets-list">
                    <p style="color: #666; text-align: center; margin: 20px 0;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>

                <div
                    style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 12px; margin-top: 20px; border: 1px dashed var(--text-secondary);">
                    <p style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">
                        ‚ÑπÔ∏è <b>–ë–∏–ª–µ—Ç—ã –Ω–∞ –¥—Ä—É–≥–∏–µ —à–æ—É</b><br>
                        –ï—Å–ª–∏ –≤—ã –ø—Ä–∏–æ–±—Ä–µ–ª–∏ –±–∏–ª–µ—Ç—ã –Ω–∞ ¬´–°–µ–∫—Ä–µ—Ç¬ª –∏–ª–∏ ¬´–°–ø–∞—Å—Ç–∏ –ú–∞—Ç–≤–µ—è¬ª, –æ–Ω–∏ –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à—É
                        —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É –±–∏–ª–µ—Ç–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º <b>QuickTickets</b>. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–í—Ö–æ–¥—è—â–∏–µ" –∏–ª–∏ "–°–ø–∞–º".
                    </p>
                </div>

                <div style="height: 100px;"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-scanner">
        <div class="modal-content">
            <button class="modal-close" onclick="closeScanner()">‚úï</button>
            <div class="modal-body" style="margin-top: 40px;">
                <h2 class="modal-title">–°–∫–∞–Ω–µ—Ä –±–∏–ª–µ—Ç–æ–≤</h2>
                <div id="reader" style="width: 100%; border-radius: 12px; overflow: hidden;"></div>
                <div id="scan-result"
                    style="margin-top: 20px; text-align: center; white-space: pre-line; min-height: 50px;">
                    –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Admin Panel (Hidden by default) -->
        <div id="admin-panel">
            <h2>‚öôÔ∏è –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <button class="btn" style="background: #2ed573; margin-bottom: 20px;" onclick="openScanner()">üì∑ –°–∫–∞–Ω–µ—Ä
                QR-–∫–æ–¥–æ–≤</button>
            <a href="/api/export-guests" target="_blank" class="btn"
                style="background: #3498db; margin-bottom: 20px; text-decoration: none; display: block; text-align: center;">üì•
                –°–∫–∞—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ (CSV)</a>
            <a href="/scanner.html" target="_blank" class="btn"
                style="background: #9b59b6; margin-bottom: 20px; text-decoration: none; display: block; text-align: center;">üì±
                –û—Ç–∫—Ä—ã—Ç—å SMART-–°–ö–ê–ù–ï–†</a>

            <h3>üí∞ –¶–µ–Ω—ã –∏ —Å—Å—ã–ª–∫–∏</h3>
            <div class="form-group">
                <label class="form-label">–¶–µ–Ω–∞ –•—É–ª–∏–≥–∞–Ω –≠–∫–æ–Ω–æ–º (–∫–æ–ø):</label>
                <input type="number" id="admin-hooligan-price-eco" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">–¶–µ–Ω–∞ –•—É–ª–∏–≥–∞–Ω –°—Ç–∞–Ω–¥–∞—Ä—Ç (–∫–æ–ø):</label>
                <input type="number" id="admin-hooligan-price-std" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">–¶–µ–Ω–∞ –•—É–ª–∏–≥–∞–Ω VIP (–∫–æ–ø):</label>
                <input type="number" id="admin-hooligan-price-vip" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">–°—Å—ã–ª–∫–∞ –°–µ–∫—Ä–µ—Ç:</label>
                <input type="text" id="admin-secret-link" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">–°—Å—ã–ª–∫–∞ –ú–∞—Ç–≤–µ–π:</label>
                <input type="text" id="admin-matvey-link" class="form-input">
            </div>

            <h3>üìÖ –î–∞—Ç—ã —à–æ—É (–¥–ª—è —Ç–∞–π–º–µ—Ä–∞)</h3>
            <div class="form-group">
                <label class="form-label">–î–∞—Ç–∞ –•—É–ª–∏–≥–∞–Ω:</label>
                <input type="datetime-local" id="admin-hooligan-date" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">–î–∞—Ç–∞ –°–µ–∫—Ä–µ—Ç:</label>
                <input type="datetime-local" id="admin-secret-date" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">–î–∞—Ç–∞ –ú–∞—Ç–≤–µ–π:</label>
                <input type="datetime-local" id="admin-matvey-date" class="form-input">
            </div>

            <h3>üìç –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–•—É–ª–∏–≥–∞–Ω)</h3>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–æ—â–∞–¥–∫–∏:</label>
                <input type="text" id="admin-hooligan-venue" class="form-input"
                    placeholder="–õ–æ—Ñ—Ç –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ü–æ–ª–∏–≥—Ä–∞—Ñ">
            </div>
            <div class="form-group">
                <label class="form-label">–ê–¥—Ä–µ—Å:</label>
                <input type="text" id="admin-hooligan-address" class="form-input"
                    placeholder="—É–ª. –ë–æ–ª—å—à–∞—è –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, –¥. 45">
            </div>

            <h3>üéü –û—Å—Ç–∞–ª–æ—Å—å –±–∏–ª–µ—Ç–æ–≤</h3>
            <div class="form-group">
                <label class="form-label">–ë–∏–ª–µ—Ç–æ–≤ –•—É–ª–∏–≥–∞–Ω:</label>
                <input type="number" id="admin-hooligan-tickets" class="form-input" min="0">
            </div>
            <div class="form-group">
                <label class="form-label">–ë–∏–ª–µ—Ç–æ–≤ –°–µ–∫—Ä–µ—Ç:</label>
                <input type="number" id="admin-secret-tickets" class="form-input" min="0">
            </div>
            <div class="form-group">
                <label class="form-label">–ë–∏–ª–µ—Ç–æ–≤ –ú–∞—Ç–≤–µ–π:</label>
                <input type="number" id="admin-matvey-tickets" class="form-input" min="0">
            </div>

            <button class="btn" onclick="saveConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>

        <!-- Header -->
        <header>
            <h1>KOSTYUK PROJECT</h1>
            <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</p>
            <button class="btn"
                style="background: rgba(255, 255, 255, 0.1); margin-top: 15px; font-size: 0.9rem; padding: 10px;"
                onclick="openMyTickets()">
                üéü –ú–æ–∏ –±–∏–ª–µ—Ç—ã
            </button>
        </header>

        <div class="concert-grid">

            <!-- 1. Magic Standup "Hooligan" (16+) -->
            <div class="card" id="card-hooligan" onclick="openModal('hooligan')">
                <div class="card-image-container">
                    <img src="./assets/hooligan.png" alt="–ú–∞–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–Ω–¥–∞–ø –•—É–ª–∏–≥–∞–Ω" class="card-image">
                    <div class="age-badge">16+</div>
                    <div class="tickets-badge" id="tickets-hooligan">üî• –û—Å—Ç–∞–ª–æ—Å—å: <span>--</span></div>
                </div>
                <div class="card-content">
                    <h2 class="card-title">–ú–∞–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–Ω–¥–∞–ø ¬´–•—É–ª–∏–≥–∞–Ω¬ª</h2>
                    <p class="card-desc">–ù–µ–ø—Ä–µ–≤–∑–æ–π–¥–µ–Ω–Ω–æ–µ —à–æ—É –º–∞–≥–∏–∏ –∏ –∫–æ–º–µ–¥–∏–∏.</p>
                    <div class="countdown" id="countdown-hooligan">
                        <div class="countdown-item">
                            <div class="countdown-value" data-days>--</div>
                            <div class="countdown-label">–¥–Ω–µ–π</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" data-hours>--</div>
                            <div class="countdown-label">—á–∞—Å–æ–≤</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" data-mins>--</div>
                            <div class="countdown-label">–º–∏–Ω—É—Ç</div>
                        </div>
                    </div>
                    <button class="btn" id="btn-hooligan" onclick="event.stopPropagation(); buyHooligan()">
                        <span class="text">üéü –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</span>
                        <div class="loader"></div>
                    </button>
                </div>
            </div>

            <!-- 2. Show "Secret" (12+) -->
            <div class="card" id="card-secret" onclick="openModal('secret')">
                <div class="card-image-container">
                    <img src="./assets/secret.png" alt="–®–æ—É –°–µ–∫—Ä–µ—Ç" class="card-image">
                    <div class="age-badge">12+</div>
                    <div class="tickets-badge" id="tickets-secret">üî• –û—Å—Ç–∞–ª–æ—Å—å: <span>--</span></div>
                </div>
                <div class="card-content">
                    <h2 class="card-title">–®–æ—É ¬´–°–µ–∫—Ä–µ—Ç¬ª</h2>
                    <p class="card-desc">–§–æ–∫—É—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç –Ω–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –∞ –≤–∑–≥–ª—è–¥ –Ω–∞ –∂–∏–∑–Ω—å.</p>
                    <div class="countdown" id="countdown-secret">
                        <div class="countdown-item">
                            <div class="countdown-value" data-days>--</div>
                            <div class="countdown-label">–¥–Ω–µ–π</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" data-hours>--</div>
                            <div class="countdown-label">—á–∞—Å–æ–≤</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" data-mins>--</div>
                            <div class="countdown-label">–º–∏–Ω—É—Ç</div>
                        </div>
                    </div>
                    <a href="#" id="link-secret" target="_blank" class="btn" onclick="event.stopPropagation()">
                        <span class="text">üéü –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</span>
                    </a>
                </div>
            </div>

            <!-- 3. Performance "Save Matvey" (6+) -->
            <div class="card" id="card-matvey" onclick="openModal('matvey')">
                <div class="card-image-container">
                    <img src="./assets/matvey.png" alt="–°–ø–∞—Å—Ç–∏ –ú–∞—Ç–≤–µ—è" class="card-image">
                    <div class="age-badge">6+</div>
                    <div class="tickets-badge" id="tickets-matvey">üî• –û—Å—Ç–∞–ª–æ—Å—å: <span>--</span></div>
                </div>
                <div class="card-content">
                    <h2 class="card-title">–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–µ—Å—Ç-—Å–ø–µ–∫—Ç–∞–∫–ª—å ¬´–°–ø–∞—Å—Ç–∏ –ú–∞—Ç–≤–µ—è¬ª</h2>
                    <p class="card-desc">–£–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ–π —Å–µ–º—å–∏.</p>
                    <div class="countdown" id="countdown-matvey">
                        <div class="countdown-item">
                            <div class="countdown-value" data-days>--</div>
                            <div class="countdown-label">–¥–Ω–µ–π</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" data-hours>--</div>
                            <div class="countdown-label">—á–∞—Å–æ–≤</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" data-mins>--</div>
                            <div class="countdown-label">–º–∏–Ω—É—Ç</div>
                        </div>
                    </div>
                    <a href="#" id="link-matvey" target="_blank" class="btn" onclick="event.stopPropagation()">
                        <span class="text">üéü –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</span>
                    </a>
                </div>
            </div>

        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        // Force full height to prevent scrolling glitches
        tg.enableClosingConfirmation();

        document.body.style.backgroundColor = tg.themeParams.bg_color || '#0d0d12';

        // Modals Logic
        function openModal(id) {
            const modal = document.getElementById('modal-' + id);
            if (modal) {
                modal.classList.add('active');
                tg.BackButton.show();
                tg.BackButton.onClick(() => closeModal(id));
            }
        }

        function closeModal(id) {
            const modal = document.getElementById('modal-' + id);
            if (modal) {
                modal.classList.remove('active');
                tg.BackButton.hide();
                tg.BackButton.offClick();
            }
        }

        // Create magic particles
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 30;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (10 + Math.random() * 10) + 's';

                // Random sizes
                const size = 2 + Math.random() * 4;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';

                // Random colors (gold, white, light purple)
                const colors = ['#ffd700', '#ffffff', '#c9a0ff', '#ffb347'];
                particle.style.background = `radial-gradient(circle, ${colors[Math.floor(Math.random() * colors.length)]} 0%, transparent 70%)`;

                container.appendChild(particle);
            }
        }
        createParticles();

        // Default Config with dates and tickets
        const DEFAULT_CONFIG = {
            prices: {
                hooligan: {
                    eco: 100000,
                    std: 150000,
                    vip: 250000
                }
            },
            links: {
                secret: "https://quicktickets.ru/yaroslavl-illyuzionist-dmitrij-kostyuk/s5",
                matvey: "https://quicktickets.ru/yaroslavl-illyuzionist-dmitrij-kostyuk/s6"
            },
            dates: {
                hooligan: "2026-03-15T19:00",
                secret: "2026-02-28T18:00",
                matvey: "2026-03-07T15:00"
            },
            tickets: {
                hooligan: 23,
                secret: 96,
                matvey: 639
            }
        };

        // Parse Query Params
        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('mode') === 'admin';
        const userId = urlParams.get('uid');

        if (urlParams.get('mode') === 'mytickets') {
            setTimeout(openMyTickets, 500); // Small delay to ensuring clean load
        }

        // Apply config
        applyConfig(DEFAULT_CONFIG);

        function applyConfig(cfg) {
            // Links
            document.getElementById('link-secret').href = cfg.links.secret;
            document.getElementById('link-matvey').href = cfg.links.matvey;

            // Modal Links
            const mlSecret = document.getElementById('modal-link-secret');
            if (mlSecret) mlSecret.href = cfg.links.secret;
            const mlMatvey = document.getElementById('modal-link-matvey');
            if (mlMatvey) mlMatvey.href = cfg.links.matvey;

            // Tickets remaining
            if (cfg.tickets) {
                updateTicketsBadge('hooligan', cfg.tickets.hooligan);
                updateTicketsBadge('secret', cfg.tickets.secret);
                updateTicketsBadge('matvey', cfg.tickets.matvey);
            }

            // Countdowns
            if (cfg.dates) {
                startCountdown('hooligan', cfg.dates.hooligan);
                startCountdown('secret', cfg.dates.secret);
                startCountdown('matvey', cfg.dates.matvey);
            }

            // Admin fields
            if (isAdmin) {
                // Check if prices.hooligan is object or number (compatibility)
                const hPrices = typeof cfg.prices.hooligan === 'object' ? cfg.prices.hooligan : { eco: 0, std: 0, vip: 0 };

                document.getElementById('admin-hooligan-price-eco').value = hPrices.eco;
                document.getElementById('admin-hooligan-price-std').value = hPrices.std;
                document.getElementById('admin-hooligan-price-vip').value = hPrices.vip;

                document.getElementById('admin-secret-link').value = cfg.links.secret;
                document.getElementById('admin-matvey-link').value = cfg.links.matvey;

                if (cfg.dates) {
                    document.getElementById('admin-hooligan-date').value = cfg.dates.hooligan;
                    document.getElementById('admin-secret-date').value = cfg.dates.secret;
                    document.getElementById('admin-matvey-date').value = cfg.dates.matvey;
                }
                if (cfg.tickets) {
                    document.getElementById('admin-hooligan-tickets').value = cfg.tickets.hooligan;
                    document.getElementById('admin-secret-tickets').value = cfg.tickets.secret;
                    document.getElementById('admin-matvey-tickets').value = cfg.tickets.matvey;
                }
            }

            if (cfg.location && cfg.location.hooligan) {
                document.getElementById('admin-hooligan-venue').value = cfg.location.hooligan.name || '';
                document.getElementById('admin-hooligan-address').value = cfg.location.hooligan.address || '';
            }

            // Update user facing prices in Hooligan modal
            if (cfg.prices?.hooligan && typeof cfg.prices.hooligan === 'object') {
                document.getElementById('display-price-eco').textContent = (cfg.prices.hooligan.eco / 100) + ' ‚ÇΩ';
                document.getElementById('display-price-std').textContent = (cfg.prices.hooligan.std / 100) + ' ‚ÇΩ';
                document.getElementById('display-price-vip').textContent = (cfg.prices.hooligan.vip / 100) + ' ‚ÇΩ';
            }
        }

        function updateTicketsBadge(show, count) {
            const badge = document.getElementById(`tickets-${show}`);
            if (badge && count !== undefined) {
                const span = badge.querySelector('span');
                span.textContent = count;

                // Change color based on urgency
                if (count <= 10) {
                    badge.style.background = 'linear-gradient(135deg, #ff0000 0%, #ff4444 100%)';
                } else if (count <= 30) {
                    badge.style.background = 'linear-gradient(135deg, #ff6600 0%, #ff9944 100%)';
                }
            }
        }

        function startCountdown(show, dateStr) {
            const container = document.getElementById(`countdown-${show}`);
            if (!container || !dateStr) return;

            const targetDate = new Date(dateStr).getTime();

            function update() {
                const now = new Date().getTime();
                const diff = targetDate - now;

                if (diff <= 0) {
                    container.innerHTML = '<div style="color: var(--gold-color); font-weight: 600;">üéâ –°–µ–≥–æ–¥–Ω—è!</div>';
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

                container.querySelector('[data-days]').textContent = days;
                container.querySelector('[data-hours]').textContent = hours;
                container.querySelector('[data-mins]').textContent = mins;
            }

            update();
            setInterval(update, 60000); // Update every minute
        }

        if (isAdmin) {
            document.getElementById('admin-panel').style.display = 'block';
        }

        async function saveConfig() {
            if (!isAdmin) return;

            const newConfig = {
                prices: {
                    hooligan: {
                        eco: parseInt(document.getElementById('admin-hooligan-price-eco').value) || 0,
                        std: parseInt(document.getElementById('admin-hooligan-price-std').value) || 0,
                        vip: parseInt(document.getElementById('admin-hooligan-price-vip').value) || 0
                    }
                },
                links: {
                    secret: document.getElementById('admin-secret-link').value,
                    matvey: document.getElementById('admin-matvey-link').value
                },
                dates: {
                    hooligan: document.getElementById('admin-hooligan-date').value,
                    secret: document.getElementById('admin-secret-date').value,
                    matvey: document.getElementById('admin-matvey-date').value
                },
                tickets: {
                    hooligan: parseInt(document.getElementById('admin-hooligan-tickets').value),
                    secret: parseInt(document.getElementById('admin-secret-tickets').value),
                    matvey: parseInt(document.getElementById('admin-matvey-tickets').value)
                },
                location: {
                    hooligan: {
                        name: document.getElementById('admin-hooligan-venue').value,
                        address: document.getElementById('admin-hooligan-address').value
                    }
                }
            };

            try {
                tg.sendData(JSON.stringify({
                    action: 'update_config',
                    config: newConfig,
                    secret: userId
                }));
            } catch (e) {
                alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + e.message);
            }
        }

        async function buyHooligan() {
            const btn = document.getElementById('btn-hooligan');
            if (btn.classList.contains('loading')) return;
            btn.classList.add('loading');

            if (!tg.initDataUnsafe?.user) {
                alert("–û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram.");
                btn.classList.remove('loading');
                return;
            }

            // Get selected category
            const selectedTier = document.querySelector('input[name="hooligan-tier"]:checked');
            if (!selectedTier) {
                alert("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –±–∏–ª–µ—Ç–∞!");
                btn.classList.remove('loading');
                return;
            }

            try {
                tg.sendData(JSON.stringify({
                    action: 'buy_hooligan',
                    category: selectedTier.value
                }));
            } catch (e) {
                alert("–û—à–∏–±–∫–∞.");
            } finally {
                setTimeout(() => btn.classList.remove('loading'), 1000);
            }
        }

        async function openMyTickets() {
            openModal('mytickets');
            const list = document.getElementById('tickets-list');
            list.innerHTML = '<div class="loader" style="display:block; margin: 30px auto;"></div>';

            const uid = tg.initDataUnsafe?.user?.id || userId;

            try {
                // Use relative path assuming served from same origin
                const baseUrl = window.location.origin.includes('localhost') || window.location.protocol === 'file:'
                    ? 'http://localhost:3000'
                    : '';

                const res = await fetch(`${baseUrl}/api/user-tickets?uid=${uid}`);
                const tickets = await res.json();

                if (!tickets || tickets.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: #888; margin: 30px 0;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ —à–æ—É ¬´–•—É–ª–∏–≥–∞–Ω¬ª.</p>';
                    return;
                }

                let html = '';
                tickets.forEach(t => {
                    const date = new Date(t.date).toLocaleDateString();
                    const labels = { 'eco': '–≠–∫–æ–Ω–æ–º', 'std': '–°—Ç–∞–Ω–¥–∞—Ä—Ç', 'vip': 'VIP' };
                    const tier = labels[t.category] || t.category;

                    html += `
                        <div class="card" style="margin-bottom: 15px; animation: none; opacity: 1; transform: none; background: rgba(255,255,255,0.08);">
                            <div class="card-content" style="padding: 15px;">
                                <h3 style="font-size: 1.1rem; margin-bottom: 5px;">–ú–∞–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–Ω–¥–∞–ø ¬´–•—É–ª–∏–≥–∞–Ω¬ª</h3>
                                <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                                    <span style="color: var(--gold-color); font-weight: 600;">${tier}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                    <span style="color: var(--text-secondary); font-size: 0.9rem;">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏:</span>
                                    <span style="color: white; font-size: 0.9rem;">${date}</span>
                                </div>
                                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center; color: #4cd137;">
                                    ‚úÖ –û–ø–ª–∞—á–µ–Ω–æ
                                </div>
                            </div>
                        </div>
                    `;
                });
                list.innerHTML = html;

            } catch (e) {
                console.error(e);
                list.innerHTML = '<p style="text-align: center; color: #ff6b6b; margin: 30px 0;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–ª–µ—Ç–æ–≤.</p>';
            }
        }

        // --- SCANNER LOGIC ---
        let html5QrcodeScannerVar;

        function openScanner() {
            document.getElementById('modal-scanner').classList.add('active');
            html5QrcodeScannerVar = new Html5Qrcode("reader");
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };

            html5QrcodeScannerVar.start({ facingMode: "environment" }, config, onScanSuccess)
                .catch(err => {
                    document.getElementById('scan-result').innerText = "–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: " + err;
                });
        }

        function closeScanner() {
            const modal = document.getElementById('modal-scanner');
            modal.classList.remove('active');

            if (html5QrcodeScannerVar) {
                html5QrcodeScannerVar.stop().then(() => {
                    html5QrcodeScannerVar.clear();
                }).catch(err => {
                    console.error("Failed to stop scanner", err);
                });
            }
            document.getElementById('scan-result').innerText = "–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥";
            document.getElementById('scan-result').style.color = "white";
        }

        function onScanSuccess(decodedText, decodedResult) {
            if (html5QrcodeScannerVar) {
                html5QrcodeScannerVar.pause();
            }

            const resDiv = document.getElementById('scan-result');
            resDiv.innerText = "–ü—Ä–æ–≤–µ—Ä–∫–∞... ‚è≥";

            fetch('/api/verify-ticket', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ticketId: decodedText })
            })
                .then(res => res.json())
                .then(data => {
                    resDiv.innerText = data.message;
                    if (data.success) {
                        resDiv.style.color = "#2ecc71";
                        if (window.navigator.vibrate) window.navigator.vibrate(200);
                    } else {
                        resDiv.style.color = "#e74c3c";
                        if (window.navigator.vibrate) window.navigator.vibrate([100, 50, 100]);
                    }

                    setTimeout(() => {
                        if (html5QrcodeScannerVar) html5QrcodeScannerVar.resume();
                        resDiv.style.color = "white";
                        if (data.success) resDiv.innerText = "–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥";
                    }, 3000);
                })
                .catch(err => {
                    resDiv.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
                    if (html5QrcodeScannerVar) html5QrcodeScannerVar.resume();
                });
        }
    </script>
</body>

</html>